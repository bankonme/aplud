<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Aplud : Automatic Persistent Live USB (Debian)" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Aplud</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/frwendling/aplud">View on GitHub</a>

          <h1 id="project_title">Aplud</h1>
          <h2 id="project_tagline">Automatic Persistent Live USB (Debian)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/frwendling/aplud/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/frwendling/aplud/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="aplud" class="anchor" href="#aplud"><span class="octicon octicon-link"></span></a>aplud</h1>

<p><strong><em>Automatic Persistent Live USB (Debian)</em></strong></p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<pre><code>$ wget -c http://live.debian.net/cdimage[...]debian-live-[...].iso
# whereis/aplud debian-live.iso /dev/sdX
</code></pre>

<h2>
<a name="requires" class="anchor" href="#requires"><span class="octicon octicon-link"></span></a>Requires</h2>

<ul>
<li>7z </li>
<li>syslinux</li>
<li>mkfs.vfat</li>
<li>mkfs.ext4</li>
<li>mbr</li>
<li>fdisk</li>
</ul><p>Debian distro : </p>

<pre><code>apt-get install 7zip-full syslinux dosfstools mbr util-linux
</code></pre>

<p><code>dosfstools</code> is also known as <code>mtools</code></p>

<h2>
<a name="about" class="anchor" href="#about"><span class="octicon octicon-link"></span></a>About</h2>

<p>This creates a live USB drive with:</p>

<ul>
<li>debian (by default, full persistence) </li>
<li>grml (you want <code>grml2usb</code>, full persistence)</li>
<li>ubuntu (full persistence, <em>painfully slow</em>)</li>
<li>mint (full persistence)</li>
<li>slitaz4 (home persistence only).</li>
<li>Any ISOLINUX based Live-CD (See 'Using Plugins' for limitations), it will then create an extra partition using the free space left on the device. No persistence. It has been added for convenience, it works very often, but may not. </li>
</ul><p>It's similar to unetbootin, usb-creator etc., but it's minimalist and base code is less
intimidating - it's just a shell script.</p>

<p>It will use the size of the isofile + 10% for the livesystem partition, the
rest of the pendrive storage being used for persistence/data as an ext4 filesystem.</p>

<p>It works with a plugin system, so you can create a definition for other distros.</p>

<p>The included plugins will try to set up the language and keyboard, so you should
not have to be worried about this (it uses $LANG environment variable).</p>

<h3>
<a name="performance" class="anchor" href="#performance"><span class="octicon octicon-link"></span></a>Performance</h3>

<p>Please note that persistent live usb is slower than a standard live usb.</p>

<h2>
<a name="getting-the-good-device" class="anchor" href="#getting-the-good-device"><span class="octicon octicon-link"></span></a>Getting the good device</h2>

<ul>
<li>Plug your usb pendrive in your computer</li>
<li>
<p>Run</p>

<pre><code>$ dmesg | tail
[...]
[ 5717.903243] sd 6:0:0:0: [sdb] Attached SCSI removable disk
[...]
</code></pre>
</li>
<li><p>Here the device is <code>/dev/sdb</code></p></li>
</ul><h2>
<a name="runtime-problems" class="anchor" href="#runtime-problems"><span class="octicon octicon-link"></span></a>Runtime Problems</h2>

<ul>
<li><p>fdisk fails with 'device is busy' : Aplud tries hard to circumvent
automounter programs. Anyway you should wait some seconds after plugging your
USB pendrive, then launch aplud. Also be sure no program is in a device
mountpoint</p></li>
<li><p>The resulting USB pendrive may be stuck with "MBR" message. Retry aplud on it. </p></li>
<li><p>If you have no mkfs.* programs on your system, modify global.conf accordingly.</p></li>
</ul><h2>
<a name="using-plugins" class="anchor" href="#using-plugins"><span class="octicon octicon-link"></span></a>Using Plugins</h2>

<p>Add the distro name as the third argument of aplud. To get the list of all 
supported distros, type </p>

<pre><code>$ ./aplud
</code></pre>

<h3>
<a name="using-unsupported-distros" class="anchor" href="#using-unsupported-distros"><span class="octicon octicon-link"></span></a>Using unsupported distros</h3>

<p>Use simply 'generic' as distro name. It's not granted it will work, the <code>isolinux</code>
directory must be in the <code>boot</code> directory of the ISO.</p>

<h2>
<a name="creating-plugins" class="anchor" href="#creating-plugins"><span class="octicon octicon-link"></span></a>Creating Plugins</h2>

<h3>
<a name="how-alupd-works" class="anchor" href="#how-alupd-works"><span class="octicon octicon-link"></span></a>How alupd works</h3>

<p>You need to know that before creating a plugin. In a nutshell it acts like this : </p>

<ol>
<li>Partition the drive</li>
<li>Create filesystems</li>
<li>Extract the iso in the live filesystem</li>
<li>Convert ISOLINUX to SYSLINUX <em>It's where plugin matters</em>

<ol>
<li>It needs to modify syslinux.cfg (or whatever .cfg file used by the target distro)
to add keyboard/language/whatever needed (<code>persistence</code> keyword is needed
for Debian for example).</li>
</ol>
</li>
</ol><h3>
<a name="what-you-need" class="anchor" href="#what-you-need"><span class="octicon octicon-link"></span></a>What you need</h3>

<p>For this you'll need to extract the iso and find the isolinux folder :</p>

<pre><code>$ mkdir /tmp/iso 
$ cd /tmp/iso
$ 7z x file.iso
$ find . -type d -name isolinux 
./boot/isolinux
</code></pre>

<p>Note that the syslinux prefix will be <code>"boot/"</code>. Never use a leading '/' !
If <code>isolinux/</code> is in the current directory, the syslinux prefix should be
""</p>

<p>Now read the cfg files to find the boot entries in this isolinux folder, and
catch a common string among them. Most often it's simply <code>isolinux.cfg</code>,
then try this: </p>

<pre><code>$ sed 's/\(that common string\)/\1 myparam/g' file.cfg 
</code></pre>

<p>to test.</p>

<ul>
<li>
<code>that common string</code> will be in the plugin file the value of the variable <code>appentrigger</code>
</li>
<li>
<code>myparam</code> will be in the plugin file the value of the variable <code>bootappend</code>
</li>
<li>
<code>file.cfg</code> will be in the plugin file the value of the variable <code>syslinuxcfg</code> If the file is <code>isolinux.cfg</code> then use <code>syslinux.cfg</code> instead</li>
</ul><p>You'll need to know the boot options of the live cd you wan to use as well.</p>

<h3>
<a name="actual-plugin-creation" class="anchor" href="#actual-plugin-creation"><span class="octicon octicon-link"></span></a>Actual plugin creation</h3>

<p>Let's say you want to add the 'newdistro' distribution : </p>

<pre><code>$ cd whereisaplud/conf 
$ cp grml.conf newdistro.conf
$ vi newdistro.conf
</code></pre>

<p>It's documented by itself, and if you've the values found just before, it should work:</p>

<pre><code>$ cd whereisaplud
# ./aplud newdistro-i686-20141210.iso /dev/sdX newdistro
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Aplud maintained by <a href="https://github.com/frwendling">frwendling</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
